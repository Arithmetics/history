WITH all_tagged AS (select purchases.position, price, ranking, purchases.year, purchases.player_id, name FROM purchases LEFT JOIN players ON purchases.player_id = players.id LEFT JOIN rankings ON players.id = rankings.player_id AND purchases.year = rankings.year where purchases.year = 2021 OR purchases.year = 2020 OR purchases.year = 2019) SELECT ROUND(AVG(price), 1) AS average_price, ROUND(MIN(price), 1) as min_price, ROUND(MAX(price),1) as max_ranking, position from all_tagged where position = 'QB' OR position = 'RB' OR position = 'WR' OR position = 'TE' group by ranking, POSITION ORDER BY position, ranking ASC NULLS LAST;